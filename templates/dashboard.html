{% extends "base.html" %}

{% block content %}
<!-- Alpine.js State Management -->
<div x-data="{
    filters: {
        city: 'all',
        minBudget: '',
        maxBudget: '',
        bhk: '',
        decision: 'all'
    },
    showFilters: false
}">

    <!-- Hero Section with Key Metrics -->
    <!-- UI Polish: Toned down purple, using neutral dark surface with subtle accent -->
    <div class="animate-fade-in mb-8">
        <div class="bg-slate-800/90 rounded-2xl shadow-2xl shadow-slate-950/50 p-8 border border-slate-700/50">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h2 class="text-3xl font-bold text-white mb-2">Investment Analysis Dashboard</h2>
                    <p class="text-slate-400 text-base">Data-driven insights: Should you buy or rent? Find undervalued properties.</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <button @click="showFilters = !showFilters" 
                            class="bg-slate-700 hover:bg-slate-600 text-slate-200 border border-slate-600 px-6 py-3 rounded-lg font-semibold transition shadow-lg flex items-center space-x-2">
                        <i class="fas fa-filter text-violet-400"></i>
                        <span>Filters</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Panel (Collapsible) -->
    <div x-show="showFilters" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform -translate-y-4"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         class="mb-8 animate-slide-up">
        <div class="bg-slate-800/90 rounded-xl shadow-lg p-6 border border-slate-700">
            <h3 class="text-lg font-semibold text-slate-200 mb-4 flex items-center">
                <i class="fas fa-sliders-h text-slate-500 mr-2"></i>
                Filter Properties
            </h3>
            <form method="GET" action="/dashboard" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <!-- City Filter -->
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-2">City</label>
                    <select name="city" x-model="filters.city"
                            class="w-full px-4 py-2.5 bg-slate-900 border border-slate-700 text-slate-200 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition">
                        <option value="all">All Cities</option>
                        {% for city in cities %}
                        <option value="{{ city }}">{{ city }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Min Budget -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Min Budget (‚Çπ)</label>
                    <input type="number" name="min_budget" x-model="filters.minBudget" placeholder="e.g., 5000000"
                           class="w-full px-4 py-2 bg-slate-900 border border-slate-600 text-slate-200 placeholder-slate-500 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent transition">
                </div>
                
                <!-- Max Budget -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Max Budget (‚Çπ)</label>
                    <input type="number" name="max_budget" x-model="filters.maxBudget" placeholder="e.g., 20000000"
                           class="w-full px-4 py-2 bg-slate-900 border border-slate-600 text-slate-200 placeholder-slate-500 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent transition">
                </div>
                
                <!-- BHK -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">BHK</label>
                    <select name="bhk" x-model="filters.bhk"
                            class="w-full px-4 py-2 bg-slate-900 border border-slate-600 text-slate-200 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent transition">
                        <option value="">Any</option>
                        <option value="1">1 BHK</option>
                        <option value="2">2 BHK</option>
                        <option value="3">3 BHK</option>
                        <option value="4">4+ BHK</option>
                    </select>
                </div>
                
                <!-- Decision Filter -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Recommendation</label>
                    <select name="decision" x-model="filters.decision"
                            class="w-full px-4 py-2 bg-slate-900 border border-slate-600 text-slate-200 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent transition">
                        <option value="all">All</option>
                        <option value="Buy">Buy</option>
                        <option value="Rent">Rent</option>
                    </select>
                </div>
                
                <!-- Submit Button -->
                <div class="md:col-span-3 lg:col-span-5 flex justify-end space-x-3">
                    <button type="submit" 
                            class="bg-gradient-to-r from-violet-600 to-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:from-violet-500 hover:to-indigo-500 transition shadow-lg shadow-violet-500/25">
                        <i class="fas fa-search mr-2"></i>Apply Filters
                    </button>
                    <a href="/" 
                       class="bg-slate-700 text-slate-200 px-6 py-2 rounded-lg font-semibold hover:bg-slate-600 transition">
                        <i class="fas fa-redo mr-2"></i>Reset
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 animate-slide-up">
        <!-- Total Properties Card -->
        <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700 hover:border-violet-500/50 hover:shadow-violet-500/10 transition-all hover:-translate-y-1">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-slate-400 uppercase tracking-wide">Properties Analyzed</p>
                    <p class="text-3xl font-bold text-slate-100 mt-2">{{ metrics.total_properties }}</p>
                    <p class="text-xs text-slate-500 mt-1">With investment metrics</p>
                </div>
                <div class="bg-gradient-to-br from-violet-500 to-violet-600 p-4 rounded-xl shadow-lg shadow-violet-500/25">
                    <i class="fas fa-home text-white text-2xl"></i>
                </div>
            </div>
        </div>
        
        <!-- Buy Recommendations Card -->
        <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700 hover:border-emerald-500/50 hover:shadow-emerald-500/10 transition-all hover:-translate-y-1">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-slate-400 uppercase tracking-wide">Buy Recommended</p>
                    <p class="text-3xl font-bold text-emerald-400 mt-2">{{ metrics.buy_recommendations }}</p>
                    <p class="text-xs text-slate-500 mt-1">Ownership builds more wealth</p>
                </div>
                <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 p-4 rounded-xl shadow-lg shadow-emerald-500/25">
                    <i class="fas fa-check-circle text-white text-2xl"></i>
                </div>
            </div>
        </div>
        
        <!-- Rent Recommendations Card -->
        <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700 hover:border-indigo-500/50 hover:shadow-indigo-500/10 transition-all hover:-translate-y-1">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-slate-400 uppercase tracking-wide">Rent Recommended</p>
                    <p class="text-3xl font-bold text-indigo-400 mt-2">{{ metrics.rent_recommendations }}</p>
                    <p class="text-xs text-slate-500 mt-1">Invest difference instead</p>
                </div>
                <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 p-4 rounded-xl shadow-lg shadow-indigo-500/25">
                    <i class="fas fa-chart-line text-white text-2xl"></i>
                </div>
            </div>
        </div>
        
        <!-- Average Price Card -->
        <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700 hover:border-amber-500/50 hover:shadow-amber-500/10 transition-all hover:-translate-y-1">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-slate-400 uppercase tracking-wide">Avg Property Price</p>
                    <p class="text-3xl font-bold text-amber-400 mt-2">‚Çπ{{ (metrics.avg_price / 10000000) | round(2) }}Cr</p>
                    <p class="text-xs text-slate-500 mt-1">Across all listings</p>
                </div>
                <div class="bg-gradient-to-br from-amber-500 to-orange-600 p-4 rounded-xl shadow-lg shadow-amber-500/25">
                    <i class="fas fa-rupee-sign text-white text-2xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- Buy Advantage Chart (formerly ROI) -->
        <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700">
            <h3 class="text-xl font-bold text-slate-100 mb-4 flex items-center">
                <i class="fas fa-chart-bar text-violet-400 mr-2"></i>
                Buy vs Rent Advantage (Top 10)
            </h3>
            <p class="text-xs text-slate-500 mb-2">Green = Buying better | Red = Renting better</p>
            <div class="h-80">
                <canvas id="roiChart"></canvas>
            </div>
        </div>
        
        <!-- Buy vs Rent Distribution -->
        <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700">
            <h3 class="text-xl font-bold text-slate-100 mb-4 flex items-center">
                <i class="fas fa-pie-chart text-indigo-400 mr-2"></i>
                Buy vs Rent Distribution
            </h3>
            <div class="h-80 flex items-center justify-center">
                <canvas id="buyVsRentChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Analysis Section -->
    <div id="analysis" class="mb-8">
        <h3 class="text-2xl font-bold text-slate-100 mb-6 flex items-center">
            <i class="fas fa-chart-area text-violet-400 mr-3"></i>
            City & Location Analysis
        </h3>
        
        <!-- Price Distribution Chart -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6">
            <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700">
                <h4 class="text-lg font-bold text-slate-100 mb-4 flex items-center">
                    <i class="fas fa-city text-emerald-400 mr-2"></i>
                    Average Price by City
                </h4>
                <div class="h-80">
                    <canvas id="priceDistributionChart"></canvas>
                </div>
            </div>
            
            <!-- City Properties Count Chart -->
            <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700">
                <h4 class="text-lg font-bold text-slate-100 mb-4 flex items-center">
                    <i class="fas fa-building text-blue-400 mr-2"></i>
                    Properties Count by City
                </h4>
                <div class="h-80">
                    <canvas id="cityPropertiesChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Location Analysis Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6">
            <!-- Top Locations by Avg Price -->
            <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700">
                <h4 class="text-lg font-bold text-slate-100 mb-4 flex items-center">
                    <i class="fas fa-map-marker-alt text-red-400 mr-2"></i>
                    Top Locations by Average Price
                </h4>
                <div class="h-80">
                    <canvas id="locationPriceChart"></canvas>
                </div>
            </div>
            
            <!-- Price per Sqft by City -->
            <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700">
                <h4 class="text-lg font-bold text-slate-100 mb-4 flex items-center">
                    <i class="fas fa-ruler-combined text-amber-400 mr-2"></i>
                    Price per Sqft by City
                </h4>
                <div class="h-80">
                    <canvas id="pricePerSqftChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Properties Grid -->
    <div id="properties" class="mb-8">
        <h3 class="text-2xl font-bold text-slate-100 mb-6 flex items-center">
            <i class="fas fa-building text-emerald-400 mr-3"></i>
            Property Listings
        </h3>
        
        {% if properties and properties|length > 0 %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for property in properties[:12] %}
            <div x-data="{ expanded: false }" class="bg-slate-800/80 rounded-xl shadow-lg overflow-hidden border border-slate-700 hover:border-violet-500/50 hover:shadow-violet-500/10 transition-all hover:-translate-y-1">
                <!-- Property Header -->
                <div class="bg-gradient-to-r from-violet-600 to-indigo-600 p-4 text-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-bold text-lg">{{ property.location }}</h4>
                            <p class="text-sm text-violet-200">{{ property.city }}</p>
                        </div>
                        <span class="{% if property.decision == 'Buy' %}bg-emerald-500{% else %}bg-indigo-500{% endif %} px-3 py-1 rounded-full text-xs font-semibold">
                            {{ property.decision }}
                        </span>
                    </div>
                </div>
                
                <!-- Property Details -->
                <div class="p-4">
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-rupee-sign text-violet-400"></i>
                            <div>
                                <p class="text-xs text-slate-500">Price</p>
                                <p class="font-semibold text-slate-200">‚Çπ{{ (property.price / 10000000) | round(2) }}Cr</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-expand text-violet-400"></i>
                            <div>
                                <p class="text-xs text-slate-500">Area</p>
                                <p class="font-semibold text-slate-200">{{ property.area_sqft }} sqft</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-bed text-violet-400"></i>
                            <div>
                                <p class="text-xs text-slate-500">BHK</p>
                                <p class="font-semibold text-slate-200">{{ property.bhk }} BHK</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-chart-line text-violet-400"></i>
                            <div>
                                <p class="text-xs text-slate-500">Price/sqft</p>
                                <p class="font-semibold text-slate-200">‚Çπ{{ property.price_per_sqft | round(0) | int }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Wealth Comparison (Always Visible) -->
                    <div class="border-t border-slate-700 pt-3 mt-3">
                        <p class="text-xs text-slate-400 mb-2 font-medium">20-Year Wealth Projection:</p>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div class="bg-emerald-900/50 border border-emerald-700/50 p-2 rounded">
                                <p class="text-slate-400">Buy</p>
                                <p class="font-bold text-emerald-400">‚Çπ{{ (property.wealth_buying / 10000000) | round(2) }}Cr</p>
                            </div>
                            <div class="bg-indigo-900/50 border border-indigo-700/50 p-2 rounded">
                                <p class="text-slate-400">Rent</p>
                                <p class="font-bold text-indigo-400">‚Çπ{{ (property.wealth_renting / 10000000) | round(2) }}Cr</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expanded Details Section -->
                    <div x-show="expanded" 
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 transform -translate-y-2"
                         x-transition:enter-end="opacity-100 transform translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 transform translate-y-0"
                         x-transition:leave-end="opacity-0 transform -translate-y-2"
                         class="border-t border-slate-700 pt-3 mt-3">
                        
                        <!-- Additional Financial Details -->
                        <p class="text-xs text-slate-400 mb-2 font-medium">Financial Details:</p>
                        <div class="grid grid-cols-2 gap-2 text-xs mb-3">
                            {% if property.monthly_emi %}
                            <div class="bg-amber-900/50 border border-amber-700/50 p-2 rounded">
                                <p class="text-slate-400">Monthly EMI</p>
                                <p class="font-bold text-amber-400">‚Çπ{{ (property.monthly_emi / 1000) | round(1) }}K</p>
                            </div>
                            {% endif %}
                            {% if property.estimated_rent %}
                            <div class="bg-blue-900/50 border border-blue-700/50 p-2 rounded">
                                <p class="text-slate-400">Est. Rent</p>
                                <p class="font-bold text-blue-400">‚Çπ{{ (property.estimated_rent / 1000) | round(1) }}K</p>
                            </div>
                            {% endif %}
                            {% if property.roi_percent %}
                            <div class="bg-violet-900/50 border border-violet-700/50 p-2 rounded">
                                <p class="text-slate-400">ROI</p>
                                <p class="font-bold text-violet-400">{{ property.roi_percent | round(2) }}%</p>
                            </div>
                            {% endif %}
                            {% if property.rental_yield %}
                            <div class="bg-teal-900/50 border border-teal-700/50 p-2 rounded">
                                <p class="text-slate-400">Rental Yield</p>
                                <p class="font-bold text-teal-400">{{ property.rental_yield | round(2) }}%</p>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Investment Analysis -->
                        <p class="text-xs text-slate-400 mb-2 font-medium">Investment Analysis:</p>
                        <div class="bg-slate-900/50 border border-slate-700 p-3 rounded-lg text-xs space-y-2">
                            {% if property.down_payment %}
                            <div class="flex justify-between">
                                <span class="text-slate-400">Down Payment (20%):</span>
                                <span class="font-semibold text-slate-200">‚Çπ{{ (property.down_payment / 100000) | round(2) }}L</span>
                            </div>
                            {% endif %}
                            {% if property.loan_amount %}
                            <div class="flex justify-between">
                                <span class="text-slate-400">Loan Amount:</span>
                                <span class="font-semibold text-slate-200">‚Çπ{{ (property.loan_amount / 10000000) | round(2) }}Cr</span>
                            </div>
                            {% endif %}
                            <div class="flex justify-between">
                                <span class="text-slate-400">Total Area:</span>
                                <span class="font-semibold text-slate-200">{{ property.area_sqft }} sq.ft</span>
                            </div>
                            {% if property.future_value %}
                            <div class="flex justify-between">
                                <span class="text-slate-400">Future Value (20Y):</span>
                                <span class="font-semibold text-emerald-400">‚Çπ{{ (property.future_value / 10000000) | round(2) }}Cr</span>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Recommendation Badge -->
                        <div class="mt-3 p-3 rounded-lg {% if property.decision == 'Buy' %}bg-emerald-900/50 border border-emerald-700/50{% else %}bg-indigo-900/50 border border-indigo-700/50{% endif %}">
                            <div class="flex items-center space-x-2">
                                <i class="fas {% if property.decision == 'Buy' %}fa-thumbs-up text-emerald-400{% else %}fa-hand-paper text-indigo-400{% endif %}"></i>
                                <span class="text-sm font-semibold {% if property.decision == 'Buy' %}text-emerald-400{% else %}text-indigo-400{% endif %}">
                                    {% if property.decision == 'Buy' %}
                                    Recommended to Buy - Better long-term wealth creation
                                    {% else %}
                                    Recommended to Rent - Better investment returns elsewhere
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expand/Collapse Button -->
                    <button @click="expanded = !expanded" 
                            class="w-full mt-4 bg-gradient-to-r from-violet-600 to-indigo-600 text-white py-2 rounded-lg font-semibold hover:from-violet-500 hover:to-indigo-500 transition shadow-lg shadow-violet-500/25 flex items-center justify-center space-x-2">
                        <span x-text="expanded ? 'Show Less' : 'View Details'"></span>
                        <i class="fas" :class="expanded ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="bg-slate-800/80 rounded-xl shadow-lg p-12 text-center border border-slate-700">
            <i class="fas fa-home text-slate-600 text-6xl mb-4"></i>
            <h4 class="text-xl font-bold text-slate-300 mb-2">No Properties Found</h4>
            <p class="text-slate-500">Try adjusting your filters or check back later for new listings.</p>
        </div>
        {% endif %}
    </div>

    <!-- Financial Assumptions Section -->
    <div id="assumptions" class="mb-8">
        <h3 class="text-2xl font-bold text-slate-100 mb-6 flex items-center">
            <i class="fas fa-calculator text-amber-400 mr-3"></i>
            Financial Assumptions
        </h3>
        
        <div class="bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700">
            <p class="text-sm text-slate-400 mb-4">All investment projections use the following assumptions. These are industry-standard defaults and can be adjusted based on individual circumstances.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Down Payment -->
                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-percentage text-emerald-400"></i>
                        <span class="text-sm font-semibold text-slate-300">Down Payment</span>
                    </div>
                    <p class="text-2xl font-bold text-emerald-400">20%</p>
                    <p class="text-xs text-slate-500 mt-1">Standard home loan requirement</p>
                </div>
                
                <!-- Loan Rate -->
                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-university text-blue-400"></i>
                        <span class="text-sm font-semibold text-slate-300">Loan Rate</span>
                    </div>
                    <p class="text-2xl font-bold text-blue-400">8.5%</p>
                    <p class="text-xs text-slate-500 mt-1">Average home loan interest</p>
                </div>
                
                <!-- Appreciation -->
                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-chart-line text-violet-400"></i>
                        <span class="text-sm font-semibold text-slate-300">Appreciation</span>
                    </div>
                    <p class="text-2xl font-bold text-violet-400">5%/yr</p>
                    <p class="text-xs text-slate-500 mt-1">Property value growth</p>
                </div>
                
                <!-- Investment Return -->
                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-piggy-bank text-amber-400"></i>
                        <span class="text-sm font-semibold text-slate-300">Alt Investment</span>
                    </div>
                    <p class="text-2xl font-bold text-amber-400">10%/yr</p>
                    <p class="text-xs text-slate-500 mt-1">Equity/index fund return</p>
                </div>
            </div>
            
            <div class="mt-4 p-3 bg-slate-900/30 rounded-lg border border-slate-700/50">
                <p class="text-xs text-slate-400">
                    <i class="fas fa-info-circle text-violet-400 mr-1"></i>
                    <strong>Holding Period:</strong> 20 years | 
                    <strong>Rent Escalation:</strong> 5%/yr | 
                    <strong>Loan Tenure:</strong> 20 years |
                    <strong>Rental Yield:</strong> ~3-4% annually
                </p>
                <p class="text-xs text-slate-500 mt-1">
                    Ask the AI assistant for <strong>scenario analysis</strong> (conservative/moderate/aggressive) to see how different assumptions affect outcomes.
                </p>
            </div>
        </div>
    </div>

    <!-- AI Chat Assistant Section -->
    <div id="ai-assistant" class="mb-8 scroll-mt-20">
        <h3 class="text-2xl font-bold text-slate-100 mb-6 flex items-center">
            <i class="fas fa-robot text-violet-400 mr-3"></i>
            Property Investment Assistant
        </h3>
        
        <div class="bg-slate-800/80 rounded-xl shadow-lg border border-slate-700 overflow-hidden">
            <!-- Chat Header -->
            <div class="bg-gradient-to-r from-violet-600 to-indigo-600 p-4 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                            <i class="fas fa-robot text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">RAG-Based AI</h4>
                            <p class="text-xs text-violet-200">Grounded in your property data</p>
                        </div>
                    </div>
                    <button id="clearChatBtn" class="p-2 hover:bg-white/10 rounded-lg transition">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
            
            <!-- Chat Messages -->
            <div id="chatMessages" class="h-96 overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-slate-900 to-slate-800">
                <!-- Welcome Message -->
                <div class="flex items-start space-x-3 animate-fade-in">
                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-violet-500 to-indigo-500 flex items-center justify-center text-white text-sm">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="flex-1">
                        <div class="bg-slate-700/80 rounded-lg shadow-sm p-4 border border-slate-600">
                            <p class="text-sm text-slate-200">üëã Hello! I'm your <strong>Investment Decision Assistant</strong>.</p>
                            <p class="text-sm text-slate-300 mt-2">I use <strong>RAG (Retrieval-Augmented Generation)</strong> ‚Äî all answers are grounded in your property database of ~900 listings.</p>
                            
                            <p class="text-sm font-semibold text-emerald-400 mt-3">‚úÖ Ask me about:</p>
                            <ul class="text-sm text-slate-400 mt-1 space-y-1 ml-4">
                                <li>‚Ä¢ <strong>Investment Analysis:</strong> "Is this a good investment?"</li>
                                <li>‚Ä¢ <strong>City Profiles:</strong> "How is the market in Pune?"</li>
                                <li>‚Ä¢ <strong>Risk Assessment:</strong> "What are the risks in Mumbai?"</li>
                                <li>‚Ä¢ <strong>Scenario Analysis:</strong> "Show conservative scenario"</li>
                                <li>‚Ä¢ <strong>Property Search:</strong> "3BHK under 1Cr in Delhi"</li>
                                <li>‚Ä¢ <strong>Buy vs Rent:</strong> "Should I buy or rent?"</li>
                            </ul>
                            
                            <p class="text-sm font-semibold text-amber-400 mt-3">‚ö†Ô∏è Limitations:</p>
                            <ul class="text-sm text-slate-500 mt-1 space-y-1 ml-4">
                                <li>‚Ä¢ Dataset-bound: Only knows ~900 current listings</li>
                                <li>‚Ä¢ No legal/tax advice</li>
                                <li>‚Ä¢ Assumptions: 20% down, 8.5% loan, 5% appreciation</li>
                            </ul>
                            
                            <div class="mt-3 p-2 bg-slate-800/50 rounded border border-slate-600">
                                <p class="text-xs text-slate-400"><strong>üí° Try these:</strong></p>
                                <p class="text-xs text-violet-400 mt-1">"Is Bandra a good investment?" ‚Ä¢ "Compare Mumbai vs Pune" ‚Ä¢ "Show aggressive scenario for a 2Cr property"</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="border-t border-slate-700 p-4 bg-slate-800">
                <form id="chatForm" class="flex space-x-3">
                    <input 
                        type="text" 
                        id="chatInput" 
                        placeholder="Ask me anything about properties..." 
                        class="flex-1 px-4 py-3 bg-slate-900 border border-slate-600 text-slate-200 placeholder-slate-500 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent transition"
                        autocomplete="off"
                    >
                    <button 
                        type="submit" 
                        id="sendChatBtn"
                        class="bg-gradient-to-r from-violet-600 to-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-violet-500 hover:to-indigo-500 transition shadow-lg shadow-violet-500/25 flex items-center space-x-2">
                        <span>Send</span>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

</div>

<!-- Pass data to charts.js -->
<script>
    const chartData = {{ chart_data | tojson }};
</script>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
{% endblock %}
